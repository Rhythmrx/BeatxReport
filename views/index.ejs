<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PDF Upload</title>

  <!-- External CSS -->
  <link rel="stylesheet" href="/css/style.css" />

  <!-- Font Awesome for back icon -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
  />
</head>

<body>
  <div class="main-wrapper">
    <div class="left-side">
      <img src="/assets/group-1000004488.png" alt="Design Image" />
    </div>

    <div class="right-side">
      <div class="right-form">

        <!-- CARD SELECTION -->
        <div class="card-wrapper" id="cardWrapper">
          <div class="select-card" onclick="openForm('beatly')">
            <img src="/assets/image (3).png" />
          </div>

          <div class="select-card" onclick="openForm('rx')">
            <img src="/assets/download (1).svg" />
          </div>
        </div>

        <!-- FORM -->
        <div class="form-container hidden" id="mainForm">

          <!-- BACK BUTTON -->
          <div class="back-btn" onclick="goBack()">
            <i class="fa fa-arrow-left"></i>
            <span>Back</span>
          </div>

          <form action="/upload" method="post" enctype="multipart/form-data">

            <input type="hidden" name="mode" id="modeInput" />

            <h2 class="text-heading" id="formTitle">
              Create a Customized PDF
            </h2>

            <div class="form-group">
              <label>Name</label>
              <input type="text" name="textName" placeholder="Enter doctor's name" />
            </div>

            <div class="form-group" id="refDoctorGroup">
              <label>Referral Doctor</label>
              <input type="text" name="refDoctor" />
            </div>

            <div class="form-group">
              <label>Doctor Education</label>
              <input type="text" name="education" />
            </div>

            <div class="form-group" id="serialGroup">
              <label>Serial Number</label>
              <input type="text" name="serialNo" />
            </div>

            <div class="form-group">
              <label>Drop Page</label>
              <input type="number" name="page" />
            </div>

            <div class="form-group">
              <label>Choose Input Option</label>
              <select id="inputSelector" name="inputType">
                <option value="">-- Select Option --</option>
                <option value="logo">Upload Hospital Logo</option>
                <option value="name">Enter Hospital Name</option>
              </select>
            </div>

            <div class="form-group hidden" id="hospitalNameInput">
              <label>Hospital Name</label>
              <input type="text" name="HospitalName" />
            </div>

            <div class="upload-box hidden" id="hospitalLogoUpload">
              <input type="file" id="logoUpload" name="hospitalLogo" accept="image/png" hidden />
              <button type="button" onclick="logoUpload.click()">
                Upload Hospital Logo
              </button>
              <div id="logoPreview"></div>
            </div>

            <div class="upload-box">
              <input type="file" id="pdfUpload" name="pdf" accept="application/pdf" hidden />
              <button type="button" onclick="pdfUpload.click()">
                Browse PDF
              </button>
              <div id="pdfPreview"></div>
            </div>

            <button type="submit" class="submit-btn">
              Upload & Process PDF
            </button>

          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast hidden"></div>

  <!-- SCRIPT -->
  <script>
    let selectedMode = "";

    const form = document.querySelector("#mainForm form");
    const selector = document.getElementById("inputSelector");
    const hospitalNameInput = document.getElementById("hospitalNameInput");
    const hospitalLogoUpload = document.getElementById("hospitalLogoUpload");
    const logoInput = document.getElementById("logoUpload");
    const pdfInput = document.getElementById("pdfUpload");
    const logoPreview = document.getElementById("logoPreview");
    const pdfPreview = document.getElementById("pdfPreview");

    function openForm(mode) {
      selectedMode = mode;
      document.getElementById("modeInput").value = mode;

      document.getElementById("cardWrapper").style.display = "none";
      document.getElementById("mainForm").classList.remove("hidden");

      const refDoctor = document.getElementById("refDoctorGroup");
      const serial = document.getElementById("serialGroup");
      const title = document.getElementById("formTitle");

      if (mode === "rx") {
        refDoctor.style.display = "block";
        serial.style.display = "block";
        title.innerText = "RX Normal PDF Upload";
      } else {
        refDoctor.style.display = "none";
        serial.style.display = "none";
        title.innerText = "Beatly AI PDF Upload";
      }
    }

    function goBack() {
      selectedMode = "";
      document.getElementById("modeInput").value = "";

      form.reset();
      logoPreview.innerHTML = "";
      pdfPreview.innerHTML = "";

      hospitalNameInput.classList.add("hidden");
      hospitalLogoUpload.classList.add("hidden");

      document.getElementById("mainForm").classList.add("hidden");
      document.getElementById("cardWrapper").style.display = "flex";
    }

    selector.addEventListener("change", function () {
      hospitalNameInput.classList.add("hidden");
      hospitalLogoUpload.classList.add("hidden");

      if (this.value === "name") hospitalNameInput.classList.remove("hidden");
      if (this.value === "logo") hospitalLogoUpload.classList.remove("hidden");
    });

    logoInput.addEventListener("change", function () {
      const file = this.files[0];
      if (!file || file.type !== "image/png") {
        showToast("Only PNG logo allowed");
        this.value = "";
        return;
      }
      logoPreview.innerHTML = `<img src="${URL.createObjectURL(file)}" width="120">`;
    });

    pdfInput.addEventListener("change", function () {
      const file = this.files[0];
      if (!file || file.type !== "application/pdf") {
        showToast("Only PDF allowed");
        this.value = "";
        return;
      }
      pdfPreview.innerHTML = file.name;
    });

    form.addEventListener("submit", function (e) {
      if (selectedMode === "rx" && !form.serialNo.value.trim()) {
        e.preventDefault();
        showToast("Serial number required for RX Normal");
        return;
      }

      if (!pdfInput.files.length) {
        e.preventDefault();
        showToast("PDF file is required");
      }
    });

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.className = "toast show";
      setTimeout(() => (toast.className = "toast hidden"), 3000);
    }
  </script>
</body>
</html>
